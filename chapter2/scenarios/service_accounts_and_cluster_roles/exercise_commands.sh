
## create namespaces, roles and bindings
kubectl create namespace apps
cat api-cluster-role.yml && kubectl apply -f api-cluster-role.yml
cat cluster_role_binding.yml && kubectl apply -f cluster_role_binding.yml
cat service_account_token.yml && kubectl apply -f service_account_token.yml
cat service_account.yml && kubectl apply -f service_account.yml

# create containers
kubectl create namespace rm
cat nginx_pod.yml && kubectl apply -f nginx_pod.yml
cat disposable.yml && kubectl apply -f disposable.yml
# open an IT terminal to nginx operator in apps namepsace
kubectl exec -it operator -n apps -- /bin/sh
# curl the response using the api-access bearer token
TOKEN=$(kubectl create token api-access -n apps)
curl -X GET https://$(minikube ip):6443/api/v1/pods -H "Authorization: Bearer $TOKEN" --insecure --verbose

curl -k  https://192.168.39.250:6443/api/v1/namespaces/rm/pods --header "Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IlJLdENfc2xFVVNDQVlidDg1UF9rVVBlZG5vaENjMXRqbWQyRVNvMUhEeUkifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzM5NDE1NjA3LCJpYXQiOjE3Mzk0MTIwMDcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMjc0YjU3YjctNTJmZS00MWE1LTg1YzQtZWEzNjM2ZDhjNDZiIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJhcHBzIiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImFwaS1hY2Nlc3MiLCJ1aWQiOiJiOGI2ZmQ1OS03YzZiLTRiMzctODBiYS0yYmM5Yjg5YTRiMjUifX0sIm5iZiI6MTczOTQxMjAwNywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmFwcHM6YXBpLWFjY2VzcyJ9.WRxev2Ij3wBky7t9qH894kD44RGqRASeBLZirMFk5P8WMMqiDewRR-YwdQ8awbvRepuPtVbeuk0tMEx_DXvIl3c26Gpq1FeUazfh_Jgj60RfJtzE1rrcZSqPiPo12w5CGanDzd6FkSrnScFd6fsiiygClcP4-ZPa6ZYDMv75fifFalCYrr0dxukQTUGSWVMwb53MaWvn_bFHSoVnQpqnU05Ljl8AunG1Cg-3biQLNZxKdVH98BGxAHmJe15NDJLO4fShpE3YGcWaPrVw6ITf__i3m53sc1EBXe8rJN3tm8BsIJO_D7Cc5yXp4txpkx1evrVK52ecR-thpJb5KUV0Cw"

curl -k -X DELETE https://192.168.39.250:6443/api/v1/namespaces/rm/pods --header "Authorization: Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IlJLdENfc2xFVVNDQVlidDg1UF9rVVBlZG5vaENjMXRqbWQyRVNvMUhEeUkifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzM5NDE1NjA3LCJpYXQiOjE3Mzk0MTIwMDcsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwianRpIjoiMjc0YjU3YjctNTJmZS00MWE1LTg1YzQtZWEzNjM2ZDhjNDZiIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJhcHBzIiwic2VydmljZWFjY291bnQiOnsibmFtZSI6ImFwaS1hY2Nlc3MiLCJ1aWQiOiJiOGI2ZmQ1OS03YzZiLTRiMzctODBiYS0yYmM5Yjg5YTRiMjUifX0sIm5iZiI6MTczOTQxMjAwNywic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50OmFwcHM6YXBpLWFjY2VzcyJ9.WRxev2Ij3wBky7t9qH894kD44RGqRASeBLZirMFk5P8WMMqiDewRR-YwdQ8awbvRepuPtVbeuk0tMEx_DXvIl3c26Gpq1FeUazfh_Jgj60RfJtzE1rrcZSqPiPo12w5CGanDzd6FkSrnScFd6fsiiygClcP4-ZPa6ZYDMv75fifFalCYrr0dxukQTUGSWVMwb53MaWvn_bFHSoVnQpqnU05Ljl8AunG1Cg-3biQLNZxKdVH98BGxAHmJe15NDJLO4fShpE3YGcWaPrVw6ITf__i3m53sc1EBXe8rJN3tm8BsIJO_D7Cc5yXp4txpkx1evrVK52ecR-thpJb5KUV0Cw"
